(function(){"use strict";if("undefined"==typeof sigma)throw"sigma is not declared";function t(e,n){sigma.classes.dispatcher.extend(this);var m=this,v=e,i=document.body,f=n,o=n.container.lastChild,p=n.camera,h=null,x="",t=[],r={},d=!1,b=!1;function E(e){function n(e){return parseInt(t.getPropertyValue(e).replace("px",""))||0}var t=window.getComputedStyle(e);return{left:e.getBoundingClientRect().left+n("padding-left"),top:e.getBoundingClientRect().top+n("padding-top")}}function a(e){r[e.data.node.id]||(t.push(e.data.node),r[e.data.node.id]=!0,t.length&&!d&&(h=t[t.length-1],o.addEventListener("mousedown",u)))}function s(e){var n=t.map(function(e){return e}).indexOf(e.data.node);t.splice(n,1),delete r[e.data.node.id],t.length&&!d?h=t[t.length-1]:o.removeEventListener("mousedown",u)}function u(e){d=!0;var n,t,r=v.graph.nodes().length;if(h&&1<r){for(n in o.removeEventListener("mousedown",u),i.addEventListener("mousemove",c),i.addEventListener("mouseup",l),v.cameras)void 0!==(t=v.cameras[n]).edgequadtree&&(t.edgequadtree._enabled=!1);f.settings({mouseEnabled:!1,enableHovering:!1}),v.refresh(),m.dispatchEvent("startdrag",{node:h,captor:e,renderer:f})}}function l(e){var n,t;for(n in d=!1,o.addEventListener("mousedown",u),i.removeEventListener("mousemove",c),i.removeEventListener("mouseup",l),v.cameras)void 0!==(t=v.cameras[n]).edgequadtree&&(t.edgequadtree._enabled=!0);f.settings({mouseEnabled:!0,enableHovering:!0}),v.refresh(),b&&m.dispatchEvent("drop",{node:h,captor:e,renderer:f}),m.dispatchEvent("dragend",{node:h,captor:e,renderer:f}),b=!1,h=null}function c(g){var e;function n(){for(var e,n,t=E(f.container),r=g.clientX-t.left,i=g.clientY-t.top,o=Math.cos(p.angle),d=Math.sin(p.angle),a=v.graph.nodes(),s=[],u=0;u<2;u++){var l=a[u],c={x:l.x*o+l.y*d,y:l.y*o-l.x*d,renX:l[x+"x"],renY:l[x+"y"]};s.push(c)}i=s[0].x===s[1].x&&s[0].y===s[1].y?(e=0===s[0].renX?1:s[0].renX,n=0===s[0].renY?1:s[0].renY,r=s[0].x/e*(r-s[0].renX)+s[0].x,s[0].y/n*(i-s[0].renY)+s[0].y):(e=(s[1].renX-s[0].renX)/(s[1].x-s[0].x),n=(s[1].renY-s[0].renY)/(s[1].y-s[0].y),s[1].x===s[0].x&&(e=n),s[1].y===s[0].y&&(n=e),r=(r-s[0].renX)/e+s[0].x,(i-s[0].renY)/n+s[0].y),h.x=r*o-i*d,h.y=i*o+r*d,v.refresh(),b=!0,m.dispatchEvent("drag",{node:h,captor:g,renderer:f})}-1<navigator.userAgent.toLowerCase().indexOf("firefox")?(clearTimeout(e),e=setTimeout(n,0)):n()}n instanceof sigma.renderers.svg&&(o=n.container.firstChild),x=n instanceof sigma.renderers.webgl?n.options.prefix.substr(5):n.options.prefix,n.bind("overNode",a),n.bind("outNode",s),n.bind("click",function(e){d=!1,i.removeEventListener("mousemove",c),i.removeEventListener("mouseup",l),t.length||(h=null)}),v.bind("kill",function(){m.unbindAll()}),this.unbindAll=function(){o.removeEventListener("mousedown",u),i.removeEventListener("mousemove",c),i.removeEventListener("mouseup",l),f.unbind("overNode",a),f.unbind("outNode",s)}}sigma.utils.pkg("sigma.plugins");var r={};sigma.plugins.dragNodes=function(e,n){return r[e.id]||(r[e.id]=new t(e,n)),e.bind("kill",function(){sigma.plugins.killDragNodes(e)}),r[e.id]},sigma.plugins.killDragNodes=function(e){r[e.id]instanceof t&&(r[e.id].unbindAll(),delete r[e.id])}}).call(window);